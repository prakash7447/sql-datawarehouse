select * from bronze.crm_prd_info

--checking duplicate values in crm_prd_info or if there is any null values

select prd_id,count(*) from
bronze.crm_prd_info
group by prd_id
having count(*)>1 or prd_id is null;

--this is done in order to coonect with erp_px_cat category table
select *,replace(SUBSTRING(prd_key,1,5),'-','_') as cat_id
from bronze.crm_prd_info

select *,SUBSTRING(prd_key,7,len(prd_key)-1) as prd_key
from bronze.crm_prd_info


--this is to check if there are any products that are not present in sales , but they are present in products
select *,SUBSTRING(prd_key,7,len(prd_key)-1) as prd_key
from bronze.crm_prd_info
where SUBSTRING(prd_key,7,len(prd_key)-1) not in 
(select sls_prd_key from bronze.crm_sales_details);


--check for unwanted spaces in prd_nm

select prd_nm from bronze.crm_prd_info
where prd_nm !=trim(prd_nm)

--check for null values and less than zero values
--replace null values with zero
select coalesce(prd_cost,0) from bronze.crm_prd_info
where prd_cost <0 or prd_cost is null;

--remane the prd_line 

select * from bronze.crm_prd_info

select *,prd_line,
case 
when upper(trim(prd_line)) ='M' then 'Mountain'
when upper(trim(prd_line)) ='R' then 'Road'
when upper(trim(prd_line)) ='S' then 'Other sales'
when upper(trim(prd_line)) ='T' then 'Touring'
else 'n/a'
end as prd_line
from bronze.crm_prd_info;


--entire query to fix the crm_prd_info

select prd_id,
replace(SUBSTRING(prd_key,1,5),'-','_') as cat_id,
SUBSTRING(prd_key,7,len(prd_key)-1) as prd_key,
prd_nm,
isnull(prd_cost,0) as prd_cost,
case 
when upper(trim(prd_line)) ='M' then 'Mountain'
when upper(trim(prd_line)) ='R' then 'Road'
when upper(trim(prd_line)) ='S' then 'Other sales'
when upper(trim(prd_line)) ='T' then 'Touring'
else 'n/a'
end as prd_line,
cast(prd_start_dt as date) as prd_start_dt,
cast(lead(prd_start_dt) over(partition by prd_key order by prd_start_dt)-1 as date ) as prd_end_dt
from bronze.crm_prd_info;
